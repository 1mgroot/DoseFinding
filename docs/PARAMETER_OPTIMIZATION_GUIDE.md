# 参数优化指南 (Parameter Optimization Guide)

## 概述

这个参数优化系统帮助你找到贝叶斯剂量寻找试验的最佳参数设置。系统通过系统性地测试不同的参数组合，并评估它们的性能来找到最优配置。

## 什么是"好的参数"？

在贝叶斯剂量寻找试验中，好的参数应该能够：

1. **完成试验**：避免过早终止
2. **选择正确剂量**：识别真正的最优剂量
3. **最大化效用**：获得最高的最终效用分数
4. **有效分配参与者**：合理分配参与者到不同剂量水平
5. **通过PoC验证**：确保选择的剂量通过概念验证

## 关键参数说明

### 阈值参数 (φ values)
- **φ_T (毒性阈值)**：毒性率的上限，超过此值剂量被认为不可接受
- **φ_E (疗效阈值)**：疗效率的下限，低于此值剂量被认为无效
- **φ_I (免疫反应阈值)**：免疫反应率的下限

### 可信度参数 (c values)
- **c_T (毒性可信度)**：要求毒性率低于阈值的概率
- **c_E (疗效可信度)**：要求疗效率高于阈值的概率
- **c_I (免疫反应可信度)**：要求免疫反应率高于阈值的概率

### 效用函数
- **保守型**：对毒性更敏感，奖励较低
- **平衡型**：中等风险承受度
- **激进型**：对毒性容忍度更高，奖励更高

## 使用方法

### 1. 快速优化 (推荐开始)

```r
# 在 run_optimization.R 中取消注释这一行：
quick_optimization()
```

这将测试20个参数组合，每个组合运行3次模拟，大约需要2小时。

### 2. 全面优化

```r
# 在 run_optimization.R 中取消注释这一行：
comprehensive_optimization()
```

这将测试50个参数组合，每个组合运行5次模拟，大约需要4-6小时。

### 3. 测试特定参数

```r
# 测试你感兴趣的特定参数组合
test_specific_params(
  phi_T = 0.35,  # 毒性阈值
  phi_E = 0.10,  # 疗效阈值
  phi_I = 0.20,  # 免疫反应阈值
  c_T = 0.8,     # 毒性可信度
  c_E = 0.7,     # 疗效可信度
  c_I = 0.7,     # 免疫反应可信度
  utility_type = "balanced"  # 效用类型
)
```

### 4. 分析现有结果

```r
# 分析之前运行的结果
analyze_results("quick_optimization_results.rds")
```

## 评估指标

系统使用以下指标评估参数性能：

1. **完成率**：试验成功完成的概率
2. **正确选择率**：选择正确最优剂量的概率
3. **平均最终效用**：所有模拟的平均最终效用分数
4. **PoC成功率**：通过概念验证的概率
5. **分配效率**：参与者分配的平衡程度
6. **平均参与者数量**：试验使用的平均参与者数量

## 可视化结果

系统生成以下图表：

1. **完成率 vs 参数**：显示不同参数对试验完成的影响
2. **选择率 vs 参数**：显示参数对正确剂量选择的影响
3. **效用 vs 参数**：显示参数对最终效用的影响
4. **敏感性分析**：显示每个参数的重要性
5. **最佳组合**：按效用排序的前10个参数组合

## 参数调优策略

### 保守策略
- 较低的毒性阈值 (φ_T = 0.25-0.30)
- 较高的可信度要求 (c_T, c_E, c_I = 0.8-0.95)
- 保守型效用函数

### 平衡策略
- 中等阈值设置 (φ_T = 0.30-0.35, φ_E = 0.10-0.15)
- 中等可信度要求 (c_T, c_E, c_I = 0.7-0.8)
- 平衡型效用函数

### 激进策略
- 较高的毒性阈值 (φ_T = 0.35-0.45)
- 较低的可信度要求 (c_T, c_E, c_I = 0.6-0.7)
- 激进型效用函数

## 运行建议

1. **首次运行**：使用 `quick_optimization()` 获得初步结果
2. **深入分析**：基于初步结果，使用 `test_specific_params()` 测试感兴趣的参数组合
3. **全面优化**：如果时间允许，运行 `comprehensive_optimization()` 获得更全面的结果
4. **结果分析**：使用 `analyze_results()` 深入分析结果

## 结果解释

### 最佳参数的特征
- **高完成率** (> 0.8)：试验很少过早终止
- **高正确选择率** (> 0.7)：经常选择正确的最优剂量
- **高平均效用** (> 60)：获得较高的效用分数
- **高PoC成功率** (> 0.8)：选择的剂量通过概念验证

### 参数敏感性
- 如果毒性阈值太低，试验可能过早终止
- 如果疗效阈值太高，可能错过有效剂量
- 如果可信度要求太高，可能过于保守
- 效用函数类型影响风险承受度

## 故障排除

### 常见问题
1. **试验过早终止**：降低阈值或可信度要求
2. **选择错误剂量**：调整效用函数或阈值
3. **效用分数低**：检查效用函数设置
4. **分配不均**：调整自适应随机化参数

### 调试技巧
- 使用 `test_specific_params()` 测试单个参数组合
- 检查中间结果和日志输出
- 比较不同效用函数的影响
- 分析参数敏感性图表

## 下一步

1. 运行快速优化获得初步结果
2. 分析结果找出最佳参数组合
3. 使用最佳参数运行完整试验
4. 根据实际需求微调参数
5. 考虑不同场景下的参数鲁棒性
